---
import Container from './Container.astro';
import { faqs } from '../data/faqs';

const { groups } = faqs;
---

<section class="pt-100 pb-100 max-991:pt-80 max-991:pb-80 max-767:pt-60 max-767:pb-60">
  <Container>
    <div class="faq-wrap">
      {groups.map((group, groupIndex) => (
        <div class={`reveal overflow-hidden rounded-8 border border-solid border-neutral-200 pb-40 ${groupIndex === groups.length - 1 ? 'mb-0' : 'mb-30'}`}>
          <div class="mb-65 bg-surface-gray p-30 max-991:mb-50 max-479:mb-30 max-479:px-20">
            <h2 class="faq-top-title mb-0">{group.title}</h2>
          </div>
          <div class="px-40 max-767:px-30 max-479:px-15">
            {group.items.map((item, itemIndex) => (
              <div class={`${itemIndex === group.items.length - 1 ? 'mb-0 border-b-0 pb-0' : 'mb-24 border-0 border-b border-solid border-neutral-200 pb-[31px]'}`}>
                <button
                  type="button"
                  class="flex w-full cursor-pointer items-center justify-between border-0 bg-transparent p-0 text-left max-767:items-start"
                  data-faq-toggle={`${groupIndex}-${itemIndex}`}
                  aria-expanded="false"
                  aria-controls={`faq-panel-${groupIndex}-${itemIndex}`}
                >
                  <h3 class="faq-title mb-0">{item.question}</h3>
                  <div class="relative ml-60 mt-3 flex h-30 w-30 shrink-0 items-center justify-center rounded-50 border-2 border-solid border-neutral-400 max-767:mt-[8px] max-479:ml-20 max-479:mt-[6px]">
                    <div class="absolute h-[2px] w-[41%] rounded-20 bg-neutral-400"></div>
                    <div class="plus absolute h-[38%] w-[2px] rounded-20 bg-neutral-400 transition-transform duration-300"></div>
                  </div>
                </button>
                <div
                  id={`faq-panel-${groupIndex}-${itemIndex}`}
                  class="h-0 overflow-hidden transition-[height] duration-300"
                  data-faq-panel={`${groupIndex}-${itemIndex}`}
                  aria-hidden="true"
                >
                  <div class="pt-7 pr-30 max-479:pr-0">
                    <p class="mb-0 text-body tracking-body text-ink-body">{item.answer}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </Container>
</section>

<style>
  .faq-title {
    font-family: Outfit, sans-serif;
    font-size: 26px;
    line-height: 36.4px;
    font-weight: 500;
  }

  @media (max-width: 767px) {
    .faq-title {
      font-size: 22px;
      line-height: 32px;
    }
  }

  @media (max-width: 479px) {
    .faq-title {
      font-size: 20px;
      line-height: 28px;
    }
  }
</style>

<script>
  document.querySelectorAll('[data-faq-toggle]').forEach((button) => {
    button.addEventListener('click', () => {
      const id = button.getAttribute('data-faq-toggle');
      const panel = document.querySelector(`[data-faq-panel="${id}"]`);
      const isOpen = button.getAttribute('aria-expanded') === 'true';
      const plus = button.querySelector('.plus');

      if (isOpen) {
        // Closing: set explicit height first, then animate to 0
        panel.style.height = panel.scrollHeight + 'px';
        panel.offsetHeight; // force reflow
        panel.style.height = '0px';
        button.setAttribute('aria-expanded', 'false');
        panel.setAttribute('aria-hidden', 'true');
      } else {
        // Opening: animate from 0 to content height
        panel.style.height = panel.scrollHeight + 'px';
        button.setAttribute('aria-expanded', 'true');
        panel.setAttribute('aria-hidden', 'false');
        const onEnd = () => {
          panel.style.height = 'auto';
          panel.removeEventListener('transitionend', onEnd);
        };
        panel.addEventListener('transitionend', onEnd);
      }

      if (plus) {
        plus.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(90deg)';
      }
    });
  });
</script>
