---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import Container from './Container.astro';

const { post } = Astro.props;
const isRichContent = post.content.length > 0 && typeof post.content[0] === 'object';
---

<!--
  blog-details-section
  - no section padding (relies on breadcrumb overlap)
-->
<section class="blog-details-section">
  <Container>
    <!--
      blog-details-wrap
      - z-index: 1, position: relative
      - margin-top: -255px; 991: -150px; 767: -97px; 479: -47px
    -->
    <div class="relative z-[1] mt-[-255px] max-991:mt-[-150px] max-767:mt-[-97px] max-479:mt-[-47px]">

      <!--
        blog-details-image-wrap
        - border-radius: 8px, margin-bottom: 30px, overflow: hidden
      -->
      <div class="mb-30 overflow-hidden rounded-8">
        <!-- blog-details-image: width 100% -->
        <Image
          src={(post.detailImage || post.image).src as ImageMetadata}
          alt={(post.detailImage || post.image).alt}
          class="block h-auto w-full"
          loading="lazy"
          decoding="async"
          width={1200}
          height={600}
        />
      </div>

      <!--
        blog-details-content-wrap
        - border: 1px solid #e5e7eb, rounded-16, mx-100, p-30 30 15
        - 991: mx-30
        - 767: mx-20
        - 479: mx-0, px-15
      -->
      <div class="rounded-[16px] border border-solid border-[#e5e7eb] mx-[100px] px-30 pt-30 pb-15 max-991:mx-30 max-767:mx-20 max-479:mx-0 max-479:px-15">
        <!-- blog-details-title: mb-15 -->
        <h2 class="mb-15 text-[40px] leading-[50px] xl:text-[46px] xl:leading-[55px] max-991:text-[36px] max-991:leading-[46px] max-767:text-[28px] max-767:leading-[36px] max-479:text-[26px] max-479:leading-[32px]">
          {post.title}
        </h2>

        <!-- blog-details-content (rich text) -->
        <div class="blog-details-content">
          {isRichContent ? (
            post.content.map((block: any) => {
              if (block.type === 'paragraph') {
                return <p>{block.text}</p>;
              }
              if (block.type === 'heading') {
                return <h3>{block.text}</h3>;
              }
              if (block.type === 'list') {
                return (
                  <ol>
                    {block.items.map((item: string) => <li>{item}</li>)}
                  </ol>
                );
              }
              if (block.type === 'blockquote') {
                return <blockquote>{block.text}</blockquote>;
              }
              if (block.type === 'figure') {
                return (
                  <figure>
                    <Image
                      src={block.image.src as ImageMetadata}
                      alt={block.image.alt}
                      class="h-auto w-full"
                      loading="lazy"
                      decoding="async"
                      width={1000}
                      height={500}
                    />
                  </figure>
                );
              }
              return null;
            })
          ) : (
            post.content.map((paragraph: string) => (
              <p>{paragraph}</p>
            ))
          )}
        </div>
      </div>
    </div>
  </Container>
</section>

<style>
  /* blog-details-content p: mb-15 */
  .blog-details-content :global(p) {
    margin-bottom: 15px;
  }

  /* blog-details-content h3: letter-spacing .32px, mt-32, mb-16, 32px/41.6px */
  .blog-details-content :global(h3) {
    letter-spacing: 0.32px;
    margin-top: 32px;
    margin-bottom: 16px;
    font-size: 32px;
    line-height: 41.6px;
  }

  /* blog-details-content ol: pl-25, decimal */
  .blog-details-content :global(ol) {
    padding-left: 25px;
    list-style-type: decimal;
  }

  /* blog-details-content li: no bg-image, pl-0, 18px/27px, decimal */
  .blog-details-content :global(li) {
    background-image: none;
    margin-bottom: 0;
    padding-left: 0;
    font-size: 18px;
    font-weight: 400;
    line-height: 27px;
    list-style-type: decimal;
  }

  /* blog-details-content blockquote: mt-46, mb-45 (inherits global blockquote styles) */
  .blog-details-content :global(blockquote) {
    background-color: #f5f4ea;
    letter-spacing: -0.96px;
    background-image: url('/images/blog-quote.png');
    background-position: 91% 31px;
    background-repeat: no-repeat;
    background-size: auto;
    border-left: 0 solid #000;
    border-radius: 8px;
    margin-top: 46px;
    margin-bottom: 45px;
    margin-left: 0;
    margin-right: 0;
    padding: 30px 150px 30px 30px;
    font-size: 24px;
    font-weight: 500;
    line-height: 36px;
  }

  /* blog-details-content figure: rounded-8, mb-15, overflow-hidden */
  .blog-details-content :global(figure) {
    border-radius: 8px;
    margin-left: 0;
    margin-right: 0;
    margin-bottom: 15px;
    overflow: hidden;
  }

  /* xl (1280px) */
  @media screen and (min-width: 1280px) {
    .blog-details-content :global(blockquote) {
      margin-top: 56px;
      margin-bottom: 55px;
      background-position: 91% 61px;
      padding: 60px 185px 60px 60px;
    }
  }

  /* 991px */
  @media screen and (max-width: 991px) {
    .blog-details-content :global(blockquote) {
      margin-top: 36px;
      margin-bottom: 35px;
      background-position: 95% 31px;
      padding-right: 110px;
      font-size: 20px;
      line-height: 28px;
    }

    .blog-details-content :global(h3) {
      margin-top: 22px;
      font-size: 28px;
      line-height: 38px;
    }
  }

  /* 767px */
  @media screen and (max-width: 767px) {
    .blog-details-content :global(h3) {
      margin-top: 18px;
      font-size: 26px;
      line-height: 36px;
    }

    .blog-details-content :global(blockquote) {
      margin-top: 30px;
      margin-bottom: 30px;
      background-position: 50% 30px;
      padding-left: 15px;
      padding-right: 80px;
    }
  }

  /* 479px */
  @media screen and (max-width: 479px) {
    .blog-details-content :global(blockquote) {
      text-align: center;
      padding-top: 100px;
      padding-bottom: 24px;
      padding-right: 15px;
    }
  }
</style>
