---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import Container from './Container.astro';
import { resolveImage } from '../utils/resolveImage';

const { service } = Astro.props;
const { details } = service;
const tabs = details.tabs;
const feedback = details.feedback;
---

<!--
  service-details-section + service-details-bg-color + service-details-section-padding
  - background-image: linear-gradient(#f5f4ea 20%, #fff 0%) â†’ hard stop: top 20% beige, rest white
  - xl: 31% beige | max-767: 15% beige | max-479: 10% beige
  - padding-top: 153px (xl: 169px, max-991: 129px, max-767: 109px)
-->
<section class="service-details-section pt-[153px] xl:pt-[169px] max-991:pt-[129px] max-767:pt-[109px]">
  <Container>
    <!--
      service-details-wrap
      - position: relative
    -->
    <div class="relative">

      <!--
        service-details-title
        - max-width: 72% (xl: 74%, max-479: 100%)
      -->
      <h1 class="max-w-[72%] xl:max-w-[74%] xl:text-[60px] xl:leading-[66px] max-479:max-w-full">
        {service.title}
      </h1>

      <!--
        service-details-main-image-wrap
        - border-radius: 8px, margin-top: 30px, margin-bottom: 32px, overflow: hidden
      -->
      <div class="mt-30 mb-[32px] overflow-hidden rounded-8">
        <!--
          service-details-main-image
          - width: 100%, transition: transform .3s, hover: scale(1.1)
        -->
        <Image
          src={details.image.src as ImageMetadata}
          alt={details.image.alt}
          class="block h-auto w-full transition-transform duration-300 hover:scale-110"
          loading="lazy"
          decoding="async"
          width={1170}
          height={500}
        />
      </div>

      <!--
        service-details-inner
        - display: flex, gap: 30px
        - max-991: display: block
      -->
      <div class="flex gap-30 max-991:block">

        <!--
          service-details-content-wrap (left side)
          - no specific styles, flex-grow
        -->
        <div class="min-w-0 flex-1">

          <!--
            service-details-tabs (w-tabs container)
          -->
          <div>

            <!--
              service-details-tabs-menu
              - margin-bottom: 30px
              - flex display
            -->
            <div class="mb-30 flex" role="tablist" aria-label="Service details tabs">
              {tabs.map((tab, index) => (
                <!--
                  service-details-tab-link
                  - background-color: transparent
                  - border-bottom: 2px solid #e5e7eb
                  - padding: 0 20px 10px (xl: 0 50px 10px, min-1440: 0 60px 10px, max-767: 0 8px 10px, max-479: 10px top added)
                  - .w--current: border-bottom-color: var(--secondary-color)
                -->
                <button
                  type="button"
                  class:list={[
                    'service-details-tab-link cursor-pointer border-b-2 border-t-0 border-l-0  border-r-0 border-solid bg-transparent px-20 pb-[10px] pt-0 xl:px-50 min-1440:px-60 max-767:px-[8px] max-479:pt-[10px] font-sans transition-colors duration-300',
                    index === 0 ? 'border-brand-secondary' : 'border-[#e5e7eb]'
                  ]}
                  role="tab"
                  aria-selected={index === 0 ? 'true' : 'false'}
                  aria-controls={`service-panel-${index}`}
                  id={`service-tab-${index}`}
                  data-service-tab={index}
                >
                  <!--
                    service-details-tab-text-block
                    - color: #4d5761, font-size: 22px, font-weight: 500
                    - max-767: font-size: 20px
                  -->
                  <span class="text-[22px] font-medium text-[#4d5761] max-767:text-[20px]">
                    {tab.label}
                  </span>
                </button>
              ))}
            </div>

            <!--
              service-details-tabs-content
            -->
            <div>
              {tabs.map((tab, index) => {
                const isReviewTab = !tab.richContent && !tab.content;
                return (
                  <!--
                    service-details-tab-pane
                    - border-radius: 16px, padding: 30px
                    - .service-details-tab-pane-border: border: 1px solid #e5e7eb
                    - .service-details-tab-pane-gray-bg: background-color: var(--bg-gray)
                    - max-479: px-20
                  -->
                  <div
                    role="tabpanel"
                    id={`service-panel-${index}`}
                    aria-labelledby={`service-tab-${index}`}
                    class:list={[
                      'rounded-[16px] p-30 max-479:px-20',
                      isReviewTab ? 'bg-surface-gray' : 'border border-solid border-[#e5e7eb]',
                      index === 0 ? '' : 'hidden'
                    ]}
                    data-service-panel={index}
                  >
                    {tab.richContent ? (
                      <!-- Rich HTML content (About the Service / What's Included) -->
                      <div class="service-rich-text" set:html={tab.richContent} />
                    ) : tab.content ? (
                      <!-- Simple paragraph content (fallback for other services) -->
                      <div class="service-rich-text">
                        {tab.content.map((paragraph) => (
                          <p>{paragraph}</p>
                        ))}
                      </div>
                    ) : (
                      <!-- Review tab: client feedback cards -->
                      <div>
                        {feedback.map((entry, feedbackIndex) => (
                          <!--
                            single-client-feedback-wrap
                            - bg: white, border: 1px solid #e5e7eb, rounded-8, padding: 40px 20px
                            - xl: px-40
                          -->
                          <div class:list={[
                            'rounded-8 border border-solid border-[#e5e7eb] bg-white px-20 py-[40px] xl:px-[40px]',
                            feedbackIndex < feedback.length - 1 ? 'mb-30' : ''
                          ]}>
                            <!--
                              client-feedback-top-wrap
                              - flex, flex-wrap, justify-between, items-center, gap: 10px
                              - margin-bottom: 33px (max-479: 20px)
                            -->
                            <div class="mb-[33px] flex flex-wrap items-center justify-between gap-[10px] max-479:mb-20">
                              <!--
                                client-feedback-image-info-wrap
                                - flex, flex-wrap, items-center, gap: 16px
                              -->
                              <div class="flex flex-wrap items-center gap-[16px]">
                                <!--
                                  client-feedback-image-wrap
                                  - border-radius: 100%, width: 80px, overflow: hidden
                                -->
                                <div class="h-[80px] w-[80px] overflow-hidden rounded-full">
                                  <!--
                                    client-feedback-image
                                    - border-radius: 100%, width: 100%, hover: scale(1.1)
                                  -->
                                  <Image
                                    src={entry.image.src as ImageMetadata}
                                    alt={entry.image.alt}
                                    class="h-full w-full rounded-full object-cover transition-transform duration-300 hover:scale-110"
                                    loading="lazy"
                                    decoding="async"
                                    width={80}
                                    height={80}
                                  />
                                </div>
                                <!--
                                  client-feedback-info-wrap
                                -->
                                <div>
                                  <!--
                                    client-feedback-name
                                    - letter-spacing: -0.2px, margin-bottom: 4px, font-size: 20px, font-weight: 500, line-height: 28px
                                  -->
                                  <div class="mb-[4px] text-[20px] font-medium leading-[28px] tracking-[-0.2px]">
                                    {entry.name}
                                  </div>
                                  <!--
                                    client-feedback-designation
                                  -->
                                  <div class="text-[#4d5761]">
                                    {entry.role}
                                  </div>
                                </div>
                              </div>
                              <!--
                                client-feedback-rating-icon-wrap
                                - 5 gold stars SVG
                              -->
                              <div class="flex gap-[3px]">
                                {[1, 2, 3, 4, 5].map(() => (
                                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 1L12.39 6.26L18.18 7.27L14.09 11.47L14.98 17.24L10 14.67L5.02 17.24L5.91 11.47L1.82 7.27L7.61 6.26L10 1Z" fill="#FEC84B" stroke="#FEC84B" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                ))}
                              </div>
                            </div>
                            <!--
                              client-feedback-bottom-wrap
                            -->
                            <div>
                              <!--
                                client-feedback-message
                                - color: #4d5761, margin-bottom: 0
                              -->
                              <p class="mb-0 text-[#4d5761]">
                                {entry.message}
                              </p>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                );
              })}
            </div>

          </div>
        </div>

        <!--
          service-details-form-wrap (right side)
          - flex: 0 0 370px
          - margin-top: 69px (max-991: 50px)
        -->
        <div class="shrink-0 basis-[370px] mt-[69px] max-991:mt-50 max-991:basis-auto sticky top-[40px] self-start max-991:static max-991:self-auto">
          <!--
            service-details-form-inner
            - border: 1px solid #d2d6db, border-radius: 16px, padding: 30px
            - max-479: px-20
          -->
          <div class="rounded-[16px] border border-solid border-[#d2d6db] p-30 max-479:px-20">
            <!--
              service-details-form-title
              - text-align: center, letter-spacing: .32px, margin-bottom: 20px
              - font-size: 32px, line-height: 41.6px
              - max-767: font-size: 26px, line-height: 32px
              - max-479: margin-bottom: 15px
            -->
            <h2 class="mb-20 text-center text-[32px] leading-[41.6px] tracking-[0.32px] max-767:text-[26px] max-767:leading-[32px] max-479:mb-15">
              Fill Out the Form to Receive a Call
            </h2>
            <!--
              service-details-form-excerpt
              - text-align: center, margin-bottom: 30px
              - max-767: margin-bottom: 20px
            -->
            <p class="mb-30 text-center max-767:mb-20">
              Ready to build? Fill out the form to receive a call. Let's transform your construction dreams into reality. Your project, our expertise!
            </p>
            <!--
              service-details-form-block
              - margin-bottom: 0
            -->
            <div>
              <!--
                service-details-form
              -->
              <form id="call-form" name="call-form" data-name="Call Form">
                <!--
                  service-details-input-field
                  - color: var(--heading-color), letter-spacing: .18px
                  - border: 0 solid #000, border-bottom: 1px solid #d2d6db
                  - margin-bottom: 22px, padding-bottom: 14px, padding-left: 0
                  - font-size: 18px, font-weight: 400
                  - focus: border-bottom-color: #9da4ae
                  - placeholder: color: #9da4ae
                -->
                <input
                  class="service-details-input w-full border-0 border-b border-solid border-[#d2d6db] bg-transparent pb-[14px] pl-0 text-[18px] font-normal tracking-[0.18px] text-ink-heading mb-[22px] outline-none transition-colors duration-300 focus:border-b-[#9da4ae]"
                  maxlength="256"
                  name="name"
                  placeholder="Full Name"
                  type="text"
                  required
                />
                <input
                  class="service-details-input w-full border-0 border-b border-solid border-[#d2d6db] bg-transparent pb-[14px] pl-0 text-[18px] font-normal tracking-[0.18px] text-ink-heading mb-[22px] outline-none transition-colors duration-300 focus:border-b-[#9da4ae]"
                  maxlength="256"
                  name="email"
                  placeholder="Working Email"
                  type="email"
                  required
                />
                <input
                  class="service-details-input w-full border-0 border-b border-solid border-[#d2d6db] bg-transparent pb-[14px] pl-0 text-[18px] font-normal tracking-[0.18px] text-ink-heading mb-[22px] outline-none transition-colors duration-300 focus:border-b-[#9da4ae]"
                  maxlength="256"
                  name="phone"
                  placeholder="Phone Number"
                  type="text"
                  required
                />
                <!--
                  service-details-submit-button
                  - bg: var(--secondary-color), color: white, text-align: center
                  - letter-spacing: -.16px, border-radius: 100px, width: 100%
                  - margin-top: 30px, padding: 12px 24px
                  - font-size: 16px, font-weight: 500, line-height: 24px
                  - hover: bg: var(--primary-color)
                -->
                <button
                  type="submit"
                  class="mt-10 w-full cursor-pointer rounded-[100px] border-0 bg-brand-secondary px-24 py-[12px] text-center font-sans text-[16px] font-medium leading-[24px] tracking-[-0.16px] text-white transition-colors duration-300 hover:bg-brand-primary"
                >
                  Receive a Call
                </button>
              </form>
            </div>
          </div>
        </div>

      </div>

      <!--
        service-details-shape-image
        - width: 99px, position: absolute
        - inset: 1.5% 12% auto auto (xl: right 15%, max-767: width 70px right 5%, max-479: display none)
      -->
      <Image
        src={resolveImage('/images/service-details-shape.png') as ImageMetadata}
        alt="Service Details Shape Image"
        class="service-details-shape pointer-events-none absolute top-[1.5%] right-[12%] w-[99px] h-auto xl:right-[15%] max-767:w-[70px] max-767:right-[5%] max-479:hidden"
        loading="lazy"
        decoding="async"
        width={99}
        height={68}
      />

    </div>
  </Container>
</section>

<style>
  /* Section background gradient: beige hard stop to white */
  .service-details-section {
    background-image: linear-gradient(#f5f4ea 20%, #fff 20%);
  }

  @media screen and (min-width: 1280px) {
    .service-details-section {
      background-image: linear-gradient(#f5f4ea 31%, #fff 31%);
    }
  }

  @media screen and (max-width: 767px) {
    .service-details-section {
      background-image: linear-gradient(#f5f4ea 15%, #fff 15%);
    }
  }

  @media screen and (max-width: 479px) {
    .service-details-section {
      background-image: linear-gradient(#f5f4ea 10%, #fff 10%);
    }
  }

  /* Input placeholder styling */
  .service-details-input::placeholder {
    color: #9da4ae;
  }

  /* Rich text styles: About the Service / What's Included tabs */
  .service-rich-text :global(h3) {
    letter-spacing: 0.32px;
    margin-bottom: 16px;
    font-size: 32px;
    line-height: 41.6px;
  }

  .service-rich-text :global(p) {
    margin-bottom: 16px;
  }

  .service-rich-text :global(p:last-child) {
    margin-bottom: 0;
  }

  .service-rich-text :global(ul) {
    margin-bottom: 16px;
    padding-left: 0;
    list-style-type: none;
  }

  .service-rich-text :global(li) {
    background-image: url('/images/check.png');
    background-position: 0 3px;
    background-repeat: no-repeat;
    background-size: auto;
    padding-left: 40px;
    margin-bottom: 16px;
    font-size: 22px;
    font-weight: 500;
    line-height: 30.8px;
  }

  @media screen and (max-width: 767px) {
    .service-rich-text :global(h3) {
      margin-bottom: 12px;
      font-size: 26px;
      line-height: 34px;
    }

    .service-rich-text :global(li) {
      font-size: 20px;
      line-height: 28px;
    }
  }

  /* Shape image left-to-right animation */
  @keyframes moveLeftRight {
    0% { transform: translateX(0); }
    50% { transform: translateX(30px); }
    100% { transform: translateX(0); }
  }

  .service-details-shape {
    animation: moveLeftRight 3s ease-in-out infinite;
  }
</style>

<script>
  const tabButtons = document.querySelectorAll<HTMLButtonElement>('[data-service-tab]');
  const tabPanels = document.querySelectorAll<HTMLDivElement>('[data-service-panel]');

  const activateTab = (index: number) => {
    tabButtons.forEach((btn, idx) => {
      const isActive = idx === index;
      if (isActive) {
        btn.classList.remove('border-[#e5e7eb]');
        btn.classList.add('border-brand-secondary');
      } else {
        btn.classList.remove('border-brand-secondary');
        btn.classList.add('border-[#e5e7eb]');
      }
      btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
    });
    tabPanels.forEach((panel, idx) => {
      panel.classList.toggle('hidden', idx !== index);
    });
  };

  tabButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const index = Number(btn.getAttribute('data-service-tab'));
      activateTab(index);
    });
  });
</script>
